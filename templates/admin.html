<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='/css/admin.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='/images/aninaw-tech-logo-brown.png') }}" type="image/x-icon">
    <title>Admin</title>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-transparent">
        <div class="container-fluid stickynav">

            <a class="navbar-brand " href="/"> <img
                    src="{{ url_for('static', filename='/images/aninaw-tech-logo-black.png') }}" class="rounded"
                    alt="about width=40" height="40" style="float:left">
                <h6 style="float:right; color:black;">Using K-Nearest Neighbor Regression <br>Machine Learning Algorithm
                </h6>
            </a>
            <div class="mr-auto">
                <a href="/" type="button" class="btn btn-outline-dark" style="margin:5px;">
                    VISIT PUBLIC PAGE</a>
                <a href="/adminlogin" type="button" class="btn btn-outline-dark" style="margin:5px;"
                    onclick="logoutbtn()">
                    LOGOUT</a>
            </div>
        </div>
    </nav>
    <br><br>
    <div class="row row-cols-1 row-cols-md-3 g-5 m-auto adminmain" data-aos="fade-right">
        <div class="col">
            <div class="card admincard" id="upd" role="button">
                <svg class="card-img-top admincardimg" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                    class="bi bi-arrow-repeat" viewBox="0 0 16 16">
                    <path
                        d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z" />
                    <path fill-rule="evenodd"
                        d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z" />
                </svg>
                <div class="card-body p-4 admincardbody">
                    <h5 id="selectcat" class="card-title text-center">UPDATE & SCAN DATA</h5>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card admincard" id="add" role="button">
                <svg class="card-img-top admincardimg" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                    class="bi bi-folder-plus" viewBox="0 0 16 16">
                    <path
                        d="m.5 3 .04.87a1.99 1.99 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14H9v-1H2.826a1 1 0 0 1-.995-.91l-.637-7A1 1 0 0 1 2.19 4h11.62a1 1 0 0 1 .996 1.09L14.54 8h1.005l.256-2.819A2 2 0 0 0 13.81 3H9.828a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 6.172 1H2.5a2 2 0 0 0-2 2zm5.672-1a1 1 0 0 1 .707.293L7.586 3H2.19c-.24 0-.47.042-.683.12L1.5 2.98a1 1 0 0 1 1-.98h3.672z" />
                    <path
                        d="M13.5 10a.5.5 0 0 1 .5.5V12h1.5a.5.5 0 1 1 0 1H14v1.5a.5.5 0 1 1-1 0V13h-1.5a.5.5 0 0 1 0-1H13v-1.5a.5.5 0 0 1 .5-.5z" />
                </svg>
                <div class="card-body p-4 admincardbody">
                    <h5 id="selectcat" class="card-title text-center">ADD YEAR</h5>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card admincard" id="del" role="button">
                <svg class="card-img-top admincardimg" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                    class="bi bi-folder-x" viewBox="0 0 16 16">
                    <path
                        d="M.54 3.87.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3h3.982a2 2 0 0 1 1.992 2.181L15.546 8H14.54l.265-2.91A1 1 0 0 0 13.81 4H2.19a1 1 0 0 0-.996 1.09l.637 7a1 1 0 0 0 .995.91H9v1H2.826a2 2 0 0 1-1.991-1.819l-.637-7a1.99 1.99 0 0 1 .342-1.31zm6.339-1.577A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707z" />
                    <path
                        d="M11.854 10.146a.5.5 0 0 0-.707.708L12.293 12l-1.146 1.146a.5.5 0 0 0 .707.708L13 12.707l1.146 1.147a.5.5 0 0 0 .708-.708L13.707 12l1.147-1.146a.5.5 0 0 0-.707-.708L13 11.293l-1.146-1.147z" />
                </svg>
                <div class="card-body p-4 admincardbody">
                    <h5 id="selectcat" class="card-title text-center">DELETE YEAR</h5>
                </div>
            </div>
        </div>
    </div>

    <!--MODALS-->
    <div class="modal fade" id="modalupd" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-xl insightdiv">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Checking Errors and Missing Data</h5>
                    <button id="updclosebtn1" type="button" class="btn-close" onclick="updclosebtn()"
                        style="display:none;" data-bs-toggle="modal" aria-label="Close"
                        data-bs-target="#loadingmodal"></button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="text-center p-4" id="divspin">
                            <div class="spinner-border spinnerload" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <br>
                        <h5 id="updtxt" class="text-center">CHECKING ERRORS AND MISSING DATA...</h5>
                        <div style="display:none;" id="logs">
                            <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                                <input type="radio" class="btn-check" name="btnradio" id="missbtn" autocomplete="off"
                                    checked>
                                <label class="btn btn-outline-dark btndes"
                                    for="missbtn"><strong>Missing&nbsp;</strong><span
                                        class="badge rounded-pill bg-warning text-white" id="badgemiss">2</span>
                                    </span></label>
                                <input type="radio" class="btn-check" name="btnradio" id="errbtn" autocomplete="off">
                                <label class="btn btn-outline-dark btndes"
                                    for="errbtn"><strong>Errors&nbsp;</strong><span
                                        class="badge rounded-pill bg-danger text-white" id="badgeerrs">2</span></label>
                            </div><br>
                            <table class="table table-borderless" id="listmiss">
                                <tbody id="listbodymiss">

                                </tbody>
                            </table>
                            <table class="table table-borderless" id="listerrs" style="display:none;">
                                <tbody id="listbodyerrs">
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button class="adminmodbtn modalbtns" id="cleanerr" disabled data-bs-target="#updconfirmation"
                        data-bs-toggle="modal">Fix
                        Errors & Save</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="loadingmodal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="text-center p-4">
                            <div class="spinner-border spinnerload" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <h5 id="selectcat" class="text-center">UPDATING...</h5>

                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div class="modal fade" id="updconfirmation" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="container-fluid text-center p-4">
                        <h5 id="selectcat" class="mb-4">ARE YOU SURE YOU WANT SAVE CHANGES</h5>
                        <button class="adminmodbtn modalbtns mx-5" onclick="confclosebtn()" data-bs-toggle="modal"
                            data-bs-target="#loadingmodal">SAVE</button>
                        <button class="adminmodbtn modalbtns mx-5" onclick="updclosebtn()" data-bs-toggle="modal"
                            data-bs-target="#loadingmodal">CANCEL</button>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="delconfirmation" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="container-fluid text-center p-4">
                        <h5 id="selectcat" class="mb-4">ARE YOU SURE YOU WANT DELETE THE YEAR</h5>
                        <button class="adminmodbtn modalbtns mx-5" onclick="delyearbtn()"
                            data-bs-dismiss="modal">DELETE</button>
                        <button class="adminmodbtn modalbtns mx-5" data-bs-dismiss="modal">CANCEL</button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modaldel" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Delete Year</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid text-center p-4">
                        <h5 id="selectcat" class="mb-4">SELECT YEAR:</h5>
                        <select class="form-select mb-4 mx-auto" name="del_select" id="del_select" style="width:40%;"
                            required>
                        </select>
                        <button class="adminmodbtn modalbtns mx-5" data-bs-toggle="modal"
                            data-bs-target="#delconfirmation">DELETE</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modaladd" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Add Year</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid text-center p-4">
                        <h5 id="selectcat" class="mb-4">SELECT YEAR:</h5>
                        <form method="POST" action="" enctype="multipart/form-data"
                            onsubmit="return confirm('Are you sure you want to submit?');">
                            <select class="form-select mb-4 mx-auto" name="add_select" id="add_select"
                                style="width:40%;" required>
                            </select>
                            <h5 id="selectcat" class="mb-4">UPLOAD FILE TO THE ADDED YEAR</h5>
                            <div class="form-group mb-4">
                                <input type="file" name="file" class="form-control-file" id="exampleFormControlFile1"
                                    accept=".zip">
                            </div>
                            <button type="submit" class="adminmodbtn modalbtns mx-5"
                                data-bs-dismiss="modal">ADD</button>
                            <button class="adminmodbtn modalbtns mx-5" data-bs-dismiss="modal">CANCEL</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
        crossorigin="anonymous"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        AOS.init();
    </script>
    <script>
        function myfunction() {
            if (document.getElementById('divspin').style.display === "none") {
                document.getElementById('divspin').style.display = "block";
                document.getElementById('updtxt').style.display = "block";
                document.getElementById('logs').style.display = "none";
                document.getElementById("updclosebtn1").style.display = "none";
                document.getElementById("cleanerr").disabled = true;
            }
            else {
                document.getElementById('divspin').style.display = "none";
                document.getElementById('updtxt').style.display = "none";
                document.getElementById('logs').style.display = "block";
                document.getElementById("updclosebtn1").style.display = "block";
                document.getElementById("cleanerr").disabled = false;

            }

        }
        function updclosebtn() {
            fetch('canceladminupd').then(function (response) {
                response.json().then(function (data) {
                    $('#loadingmodal').modal('hide');
                    myfunction();
                });
            });
        }
        function confclosebtn() {

            fetch('confirmadminupd').then(function (response) {
                response.json().then(function (data) {
                    $('#loadingmodal').modal('hide');
                    myfunction();
                });
            });
        }
        function delyearbtn() {
            var del_select = document.getElementById('del_select')
            fetch('delyear/' + del_select.value).then(function (response) {
                response.json().then(function (data) {
                });
            });

        }
        function logoutbtn() {
            $.removeCookie('crypt1');
            $.removeCookie('crypt2');
        }
        $("div#upd").click(function () {
            $('#modalupd').modal('show');
            fetch('adminupd').then(function (response) {
                response.json().then(function (data) {
                    tbdlbody = '';
                    tbdlbody2 = '';
                    data.miss.forEach(function (item) {
                        tbdlbody += '<tr> <td>' + item + '</td><td>Missing SCBAA</td></tr>'
                    });
                    for (let i = 0; i < data.errpath.length; i++) {
                        tbdlbody2 += '<tr><td>' + data.errpath[i] + '</td><td>' + data.errfix[i] + '</td></tr>'
                    }
                    var lstbodymiss = document.getElementById('listbodymiss')
                    var badgemiss = document.getElementById('badgemiss')
                    var lstbodyerrs = document.getElementById('listbodyerrs')
                    var badgeerrs = document.getElementById('badgeerrs')
                    lstbodymiss.innerHTML = tbdlbody;
                    badgemiss.innerHTML = data.lenmiss;
                    lstbodyerrs.innerHTML = tbdlbody2;
                    badgeerrs.innerHTML = data.lenerr;
                    myfunction()

                });
            });
        });
        $("div#add").click(function () {
            fetch('adminaddinit').then(function (response) {
                response.json().then(function (data) {
                    selectadd = '<option value="' + data.oldest + '" selected>' + data.oldest + '</option>';
                    selectadd += '<option value="' + data.newest + '">' + data.newest + '</option>';
                    var add_select = document.getElementById('add_select')
                    add_select.innerHTML = selectadd
                });
            });
            $('#modaladd').modal('show');
        });
        $("div#del").click(function () {
            fetch('admindelinit').then(function (response) {
                response.json().then(function (data) {
                    selectdel = '<option value="' + data.oldest + '" selected>' + data.oldest + '</option>';
                    selectdel += '<option value="' + data.newest + '">' + data.newest + '</option>';
                    var del_select = document.getElementById('del_select')
                    del_select.innerHTML = selectdel
                });
            });
            $('#modaldel').modal('show');
        });
        $("#missbtn").click(function () {
            document.getElementById("listmiss").style.display = "table"
            document.getElementById("listerrs").style.display = "none"
        });
        $("#errbtn").click(function () {
            document.getElementById("listmiss").style.display = "none"
            document.getElementById("listerrs").style.display = "table"
        });
    </script>
    <script>
        $(window).on("load", function () {
            if ($.cookie('crypt1') !== null && $.cookie('crypt2') !== null) {
                var c1 = $.cookie('crypt1')
                var c2 = $.cookie('crypt2')
                fetch('checkcookies/' + c1 + '/' + c2).then(function (response) {
                    response.json().then(function (data) {
                        if (data.check !== true) {
                            location.href = "/adminlogin";
                        }
                    });
                });
            }
        });
    </script>
    <script src="{{ url_for('static', filename='/js/jquery.cookie.js') }}"></script>
</body>

</html>